{% extends "templates/base.html" %}

{% block title %}{{ frappe.get_hooks("app_title")[0] }}{% endblock %}

{% block head %}
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Inter', sans-serif; }
    h1, h2, h3, h4, h5, h6, .serif { font-family: 'Merriweather', serif; }
    .dark body { background-color: #1a202c; color: #e2e8f0; }
</style>
{% endblock %}

{% block content %}
{% set posts = frappe.get_all("Ghost Post", 
    fields=["title", "slug", "excerpt", "feature_image", "published_at", "reading_time", "owner"], 
    filters={"status": "Published", "visibility": "Public"}, 
    order_by="published_at desc", 
    limit=12) 
%}

{% set featured = posts[0] if posts else None %}
{% set trending = posts[1:3] if posts|length > 1 else [] %}
{% set latest = posts[3:] if posts|length > 3 else [] %}

<div class="bg-white dark:bg-gray-900 min-h-screen text-gray-900 dark:text-gray-100">
    
    <!-- News Ticker -->
    <div class="bg-black text-white py-2 overflow-hidden whitespace-nowrap">
        <div class="inline-block animate-marquee pl-4">
            <span class="mx-4 text-sm font-bold text-red-500">BREAKING</span>
            <span class="mx-4">Welcome to the new Ghost on Frappe platform.</span>
            <span class="mx-4 text-sm font-bold text-red-500">UPDATE</span>
            <span class="mx-4">Latest version of Frappe Framework v15 is now supported.</span>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        
        <!-- Hero Section -->
        {% if featured %}
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
            <!-- Featured Post (Left 2/3) -->
            <div class="lg:col-span-2 group cursor-pointer" onclick="window.location.href='/post/{{ featured.slug }}'">
                <div class="relative overflow-hidden rounded-xl shadow-lg h-96">
                    <img src="{{ featured.feature_image or 'https://via.placeholder.com/800x600' }}" alt="{{ featured.title }}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex flex-col justify-end p-8">
                        <span class="bg-red-600 text-white text-xs font-bold px-2 py-1 rounded mb-2 w-max">FEATURED</span>
                        <h1 class="text-3xl md:text-4xl font-bold text-white mb-2 serif">{{ featured.title }}</h1>
                        <p class="text-gray-300 line-clamp-2">{{ featured.excerpt }}</p>
                    </div>
                </div>
            </div>

            <!-- Trending / Secondary (Right 1/3) -->
            <div class="flex flex-col gap-8">
                {% for post in trending %}
                <div class="group cursor-pointer h-full" onclick="window.location.href='/post/{{ post.slug }}'">
                    <div class="relative overflow-hidden rounded-xl shadow-md h-full">
                        <img src="{{ post.feature_image or 'https://via.placeholder.com/400x300' }}" alt="{{ post.title }}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent flex flex-col justify-end p-6">
                            <h3 class="text-xl font-bold text-white mb-1 serif">{{ post.title }}</h3>
                            <span class="text-xs text-gray-300">{{ post.published_at.strftime('%b %d, %Y') }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Newsletter Section -->
        <div class="bg-gray-100 dark:bg-gray-800 rounded-2xl p-8 mb-16 text-center">
            <h2 class="text-2xl font-bold mb-4 serif">Join 10,000+ subscribers</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Stay up to date with the latest news and stories.</p>
            <form class="max-w-md mx-auto flex gap-2">
                <input type="email" placeholder="Enter your email address" class="flex-1 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 dark:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-red-500">
                <button type="button" class="bg-red-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-red-700 transition">Subscribe</button>
            </form>
        </div>

        <!-- Latest Grid -->
        <div class="mb-12">
            <h2 class="text-2xl font-bold mb-6 border-b-2 border-gray-200 dark:border-gray-700 pb-2">Latest Stories</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for post in latest %}
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-md transition overflow-hidden border border-gray-100 dark:border-gray-700 flex flex-col">
                    <a href="/post/{{ post.slug }}" class="block h-48 overflow-hidden">
                        <img src="{{ post.feature_image or 'https://via.placeholder.com/400x300' }}" alt="{{ post.title }}" class="w-full h-full object-cover hover:scale-105 transition-transform duration-500">
                    </a>
                    <div class="p-6 flex-1 flex flex-col">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-xs font-semibold text-red-600 uppercase tracking-wider">News</span>
                            <span class="text-gray-400 text-xs">&bull;</span>
                            <span class="text-xs text-gray-500">{{ post.published_at.strftime('%b %d') }}</span>
                        </div>
                        <a href="/post/{{ post.slug }}">
                            <h3 class="text-xl font-bold mb-3 serif hover:text-red-600 transition">{{ post.title }}</h3>
                        </a>
                        <p class="text-gray-600 dark:text-gray-400 text-sm line-clamp-3 mb-4 flex-1">{{ post.excerpt }}</p>
                        <div class="flex items-center justify-between mt-auto pt-4 border-t border-gray-100 dark:border-gray-700">
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 rounded-full bg-gray-300 overflow-hidden">
                                    <!-- Placeholder for author image -->
                                    <img src="https://ui-avatars.com/api/?name={{ post.owner }}" alt="Author">
                                </div>
                                <span class="text-xs font-medium text-gray-900 dark:text-gray-200">{{ post.owner }}</span>
                            </div>
                            <span class="text-xs text-gray-500">{{ post.reading_time or 5 }} min read</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>
</div>
{% endblock %}
